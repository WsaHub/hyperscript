(function(){var e=typeof module!=="undefined"?module.exports:this._hyperscript;var t=0;var r=function(){self.onmessage=function(t){switch(t.data.type){case"init":importScripts(t.data._hyperscript);importScripts.apply(self,t.data.extraScripts);var r=e.internals.lexer.makeTokensObject(t.data.tokens,[],t.data.source);var a=e.internals.parser.parseElement("hyperscript",r);a.apply(self);postMessage({type:"didInit"});break;case"call":try{var n=self[t.data.function].apply(self,t.data.args);Promise.resolve(n).then((function(e){postMessage({type:"resolve",id:t.data.id,value:e})})).catch((function(e){postMessage({type:"reject",id:t.data.id,error:e.toString()})}))}catch(e){postMessage({type:"reject",id:t.data.id,error:e.toString()})}break}}};var a="("+r.toString()+")()";var n=new Blob([a],{type:"text/javascript"});var s=URL.createObjectURL(n);e.addFeature("worker",(function(e,r,a){if(a.matchToken("worker")){var n=e.requireElement("dotOrColonPath",a);var o=n.evaluate();var i=o.split(".");var c=i.pop();var p=[];if(a.matchOpToken("(")){if(a.matchOpToken(")")){}else{do{var d=a.requireTokenType("STRING").value;var u=new URL(d,location.href).href;p.push(u)}while(a.matchOpToken(","));a.requireOpToken(")")}}var l=[];var f=a.consumed.length;var v=a.consumed.length;do{var h=e.parseAnyOf(["defFeature","jsFeature"],a);if(h){if(h.type==="defFeature"){l.push(h.name);v=a.consumed.length}else{if(a.hasMore())continue}}else break}while(a.matchToken("end")&&a.hasMore());var m=a.consumed.slice(f,v+1);var y=new Worker(s);y.postMessage({type:"init",_hyperscript:r.hyperscriptUrl,extraScripts:p,tokens:m,source:a.source});var g=new Promise((function(e,t){y.addEventListener("message",(function(t){if(t.data.type==="didInit")e()}),{once:true})}));var k={};l.forEach((function(e){k[e]=function(){var r=arguments;return new Promise((function(a,n){var s=t++;y.addEventListener("message",(function e(t){if(t.data.id!==s)return;y.removeEventListener("message",e);if(t.data.type==="resolve")a(t.data.value);else n(t.data.error)}));g.then((function(){y.postMessage({type:"call",function:e,args:Array.from(r),id:s})}))}))}}));return{name:c,worker:y,install:function(e){r.assignToNamespace(e,i,c,k)}}}}))})();